import{a as P}from"./chunk-MZV6NHB3.js";import{a as $,b as R}from"./chunk-EQDQRRRY.js";var U=/_key\s*==\s*['"](.*)['"]/;function M(t){return typeof t=="string"?U.test(t.trim()):typeof t=="object"&&"_key"in t}function D(t){if(!Array.isArray(t))throw new Error("Path is not an array");return t.reduce((e,r,o)=>{let n=typeof r;if(n==="number")return`${e}[${r}]`;if(n==="string")return`${e}${o===0?"":"."}${r}`;if(M(r)&&r._key)return`${e}[_key=="${r._key}"]`;if(Array.isArray(r)){let[i,s]=r;return`${e}[${i}:${s}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(r)}\``)},"")}var w={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},I={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function F(t){return`$${t.map(e=>typeof e=="string"?`['${e.replace(/[\f\n\r\t'\\]/g,r=>w[r])}']`:typeof e=="number"?`[${e}]`:e._key!==""?`[?(@._key=='${e._key.replace(/['\\]/g,r=>w[r])}')]`:`[${e._index}]`).join("")}`}function J(t){return t.map(e=>typeof e=="string"?`['${e.replace(/[\f\n\r\t'\\]/g,r=>w[r])}']`:typeof e=="number"?`[${e}]`:e._key!==""?`[?(@._key=='${e._key.replace(/['\\]/g,r=>w[r])}')]`:`[${e._index}]`)}function A(t){let e=[],r=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g,o;for(;(o=r.exec(t))!==null;){if(o[1]!==void 0){let n=o[1].replace(/\\(\\|f|n|r|t|')/g,i=>I[i]);e.push(n);continue}if(o[2]!==void 0){e.push(parseInt(o[2],10));continue}if(o[3]!==void 0){let n=o[3].replace(/\\(\\')/g,i=>I[i]);e.push({_key:n,_index:-1});continue}}return e}function L(t){return t.map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(e._key!=="")return{_key:e._key};if(e._index!==-1)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)})}function j(t){return t.map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(e._index!==-1)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)})}function q(t,e){if(!e?.mappings)return;let r=F(j(t));if(e.mappings[r]!==void 0)return{mapping:e.mappings[r],matchedPath:r,pathSuffix:""};let o=J(j(t));for(let n=o.length-1;n>=0;n--){let i=`$${o.slice(0,n).join("")}`,s=e.mappings[i];if(s){let u=r.substring(i.length);return{mapping:s,matchedPath:i,pathSuffix:u}}}}function G(t){return t!==null&&Array.isArray(t)}function l(t,e,r=[]){if(G(t))return t.map((o,n)=>{if(P(o)){let i=o._key;if(typeof i=="string")return l(o,e,r.concat({_key:i,_index:n}))}return l(o,e,r.concat(n))});if(P(t)){if(t._type==="block"||t._type==="span"){let o=$({},t);return t._type==="block"?o.children=l(t.children,e,r.concat("children")):t._type==="span"&&(o.text=l(t.text,e,r.concat("text"))),o}return Object.fromEntries(Object.entries(t).map(([o,n])=>[o,l(n,e,r.concat(o))]))}return e(t,r)}function X(t,e,r){return l(t,(o,n)=>{if(typeof o!="string")return o;let i=q(n,e);if(!i)return o;let{mapping:s,matchedPath:u}=i;if(s.type!=="value"||s.source.type!=="documentValue")return o;let c=e.documents[s.source.document],p=e.paths[s.source.path],f=A(u),a=A(p).concat(n.slice(f.length));return r({sourcePath:a,sourceDocument:c,resultPath:n,value:o})})}var z="drafts",K="versions",g=".",C=`${z}${g}`,Z=`${K}${g}`;function W(t){return t.startsWith(C)}function E(t){return t.startsWith(Z)}function B(t){return!W(t)&&!E(t)}function Y(t){if(!E(t))return;let[e,r,...o]=t.split(g);return r}function Q(t){return E(t)?t.split(g).slice(2).join(g):W(t)?t.slice(C.length):t}function v(t){let{baseUrl:e,workspace:r="default",tool:o="default",id:n,type:i,path:s,projectId:u,dataset:c}=t;if(!e)throw new Error("baseUrl is required");if(!s)throw new Error("path is required");if(!n)throw new Error("id is required");if(e!=="/"&&e.endsWith("/"))throw new Error("baseUrl must not end with a slash");let p=r==="default"?void 0:r,f=o==="default"?void 0:o,a=Q(n),h=Array.isArray(s)?D(L(s)):s,d=new URLSearchParams({baseUrl:e,id:a,type:i,path:h});if(p&&d.set("workspace",p),f&&d.set("tool",f),u&&d.set("projectId",u),c&&d.set("dataset",c),B(n))d.set("perspective","published");else if(E(n)){let S=Y(n);d.set("perspective",S)}let y=[e==="/"?"":e];p&&y.push(p);let _=["mode=presentation",`id=${a}`,`type=${i}`,`path=${encodeURIComponent(h)}`];return f&&_.push(`tool=${f}`),y.push("intent","edit",`${_.join(";")}?${d}`),y.join("/")}function tt(t){let e=typeof t=="string"?t:t.baseUrl;return e!=="/"&&(e=e.replace(/\/$/,"")),typeof t=="string"?{baseUrl:e}:R($({},t),{baseUrl:e})}var x=({sourcePath:t,resultPath:e,value:r})=>{if(rt(r)||ot(r))return!1;let o=t.at(-1);return!(t.at(-2)==="slug"&&o==="current"||typeof o=="string"&&(o.startsWith("_")||o.endsWith("Id"))||t.some(n=>n==="meta"||n==="metadata"||n==="openGraph"||n==="seo")||T(t)||T(e)||typeof o=="string"&&et.has(o))},et=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","textTheme","unit","url","username","variant","website"]);function rt(t){return/^\d{4}-\d{2}-\d{2}/.test(t)?!!Date.parse(t):!1}var nt=new Set(["app:","data:","discord:","file:","ftp:","ftps:","geo:","http:","https:","imap:","javascript:","magnet:","mailto:","maps:","ms-excel:","ms-powerpoint:","ms-word:","slack:","sms:","spotify:","steam:","teams:","tel:","vscode:","zoom:"]);function ot(t){try{let{protocol:e}=new URL(t,t.startsWith("/")?"https://acme.com":void 0);return nt.has(e)||e.startsWith("web+")}catch(e){return!1}}function T(t){return t.some(e=>typeof e=="string"&&e.match(/type/i)!==null)}var b=[8203,8204,8205,65279],k=b.map(t=>String.fromCharCode(t)),N=[8203,8204,8205,8290,8291,8288,65279,8289,119155,119156,119157,119158,119159,119160,119161,119162];Object.fromEntries(b.map((t,e)=>[t,e]));Object.fromEntries(N.map((t,e)=>[t,e.toString(16)]));var it=String.fromCodePoint(b[0]).repeat(4),st=[...b,...N];st.map(t=>`\\u{${t.toString(16)}}`).join("");function ct(t){if(t===void 0)return"";let e=typeof t=="string"?t:JSON.stringify(t),r=new TextEncoder().encode(e),o="";for(let n=0;n<r.length;n++){let i=r[n];o+=k[i>>6&3]+k[i>>4&3]+k[i>>2&3]+k[i&3]}return it+o}function at(t,e,r="auto"){return r===!0||r==="auto"&&!ft(t)&&!pt(t)?`${t}${ct(e)}`:t}function pt(t){try{return new URL(t,t.startsWith("/")?"https://example.com":void 0),!0}catch(e){return!1}}function ft(t){return!t||typeof t!="string"?!1:!!Date.parse(t)}var m=20;function dt(t,e,r){let{filter:o,logger:n,enabled:i}=r;if(!i){let c="config.enabled must be true, don't call this function otherwise";throw n?.error?.(`[@sanity/client]: ${c}`,{result:t,resultSourceMap:e,config:r}),new TypeError(c)}if(!e)return n?.error?.("[@sanity/client]: Missing Content Source Map from response body",{result:t,resultSourceMap:e,config:r}),t;if(!r.studioUrl){let c="config.studioUrl must be defined";throw n?.error?.(`[@sanity/client]: ${c}`,{result:t,resultSourceMap:e,config:r}),new TypeError(c)}let s={encoded:[],skipped:[]},u=X(t,e,({sourcePath:c,sourceDocument:p,resultPath:f,value:a})=>{if((typeof o=="function"?o({sourcePath:c,resultPath:f,filterDefault:x,sourceDocument:p,value:a}):x({sourcePath:c,resultPath:f,value:a}))===!1)return n&&s.skipped.push({path:O(c),value:`${a.slice(0,m)}${a.length>m?"...":""}`,length:a.length}),a;n&&s.encoded.push({path:O(c),value:`${a.slice(0,m)}${a.length>m?"...":""}`,length:a.length});let{baseUrl:h,workspace:d,tool:y}=tt(typeof r.studioUrl=="function"?r.studioUrl(p):r.studioUrl);if(!h)return a;let{_id:_,_type:S,_projectId:H,_dataset:V}=p;return at(a,{origin:"sanity.io",href:v($({baseUrl:h,workspace:d,tool:y,id:_,type:S,path:c},!r.omitCrossDatasetReferenceData&&{dataset:V,projectId:H}))},!0)});if(n){let c=s.skipped.length,p=s.encoded.length;if((c||p)&&((n?.groupCollapsed||n.log)?.("[@sanity/client]: Encoding source map into result"),n.log?.(`[@sanity/client]: Paths encoded: ${s.encoded.length}, skipped: ${s.skipped.length}`)),s.encoded.length>0&&(n?.log?.("[@sanity/client]: Table of encoded paths"),(n?.table||n.log)?.(s.encoded)),s.skipped.length>0){let f=new Set;for(let{path:a}of s.skipped)f.add(a.replace(U,"0").replace(/\[\d+\]/g,"[]"));n?.log?.("[@sanity/client]: List of skipped paths",[...f.values()])}(c||p)&&n?.groupEnd?.()}return u}function O(t){return D(L(t))}var lt=Object.freeze({__proto__:null,stegaEncodeSourceMap:dt});export{X as encodeIntoResult,dt as stegaEncodeSourceMap,lt as stegaEncodeSourceMap$1};
